#include <common.h>
#include <spl.h>
#include <asm/io.h>
#include <asm/arch/base.h>
#include <asm/arch/timer.h>
#include <asm/arch/sfma.h>
#include <asm/arch/sdram.h>
#include <asm/arch/cpu.h>
#include <asm/arch/clock.h>

void board_init_f(ulong dummy)
{
    uint32_t * ddr_test = (volatile)(uint32_t *)(CONFIG_SYS_LOAD_ADDR);
    uint32_t test2 = 0;
    uint8_t rcv_tmp = 0;
    if (CONFIG_IS_ENABLED(OF_CONTROL)) {
		int ret;

		ret = spl_early_init();
		if (ret) {
			debug("spl_early_init() failed: %d\n", ret);
			hang();
		}
	}
    time_init();
    cpu_init();
    clock_init();
    sdram_init();
#if defined(CONFIG_SPL_SERIAL_SUPPORT)
	/* init console */
	/*Hardware serial init code*/
    
	preloader_console_init();
#endif
	*ddr_test = 0x5A5A5A5A;
	test2 = *ddr_test;
	if(test2 != 0x5A5A5A5A)
	{
		puts("\nDDR test failed\n");
	}
	else
	{
		puts("\nDDR test success\n");
	}
	while(true)
	{
		rcv_tmp = getchar();
            if(rcv_tmp == 0)
            {
                putc('W');
            }
            else
            {		
                putc(rcv_tmp);
            }
	}
}

u32 spl_boot_device(void)
{
	return BOOT_DEVICE_UART;
}
